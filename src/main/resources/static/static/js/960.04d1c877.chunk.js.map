{"version":3,"file":"static/js/960.04d1c877.chunk.js","mappings":"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","sources":["components/admin/AddJobApplication.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Worker, Viewer } from \"@react-pdf-viewer/core\";\r\nimport \"@react-pdf-viewer/core/lib/styles/index.css\";\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport \"./AddJobApplication.css\";\r\n\r\nconst AddJobApplication = () => {\r\n  const [profileImage, setProfileImage] = useState(null);\r\n  const [resume, setResume] = useState(null);\r\n  const [error, setError] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [userId, setUserId] = useState(null);\r\n  const [formSubmitted, setFormSubmitted] = useState(false);\r\n\r\n  const token = localStorage.getItem(\"token\");\r\n\r\n  // استخراج userId من التوكن\r\n  useEffect(() => {\r\n    if (token) {\r\n      const decodedToken = JSON.parse(atob(token.split(\".\")[1]));\r\n      setUserId(decodedToken.userId);\r\n    }\r\n  }, [token]);\r\n\r\n  // جلب البيانات من السيرفر عند تحميل الصفحة\r\n  useEffect(() => {\r\n    if (userId) {\r\n      const fetchJobApplication = async () => {\r\n        try {\r\n          const response = await axios.get(\r\n            `/api/jobapplications/user/${userId}`,\r\n            {\r\n              headers: { Authorization: `Bearer ${token}` },\r\n            },\r\n          );\r\n\r\n          if (response.status === 200 && response.data) {\r\n            const jobApplication = response.data;\r\n            setProfileImage(jobApplication.profileImagePath || null);\r\n            setResume(jobApplication.resumePath || null);\r\n          }\r\n        } catch (err) {\r\n          setError(\"حدث خطأ أثناء جلب بيانات طلب الوظيفة.\");\r\n        }\r\n      };\r\n\r\n      fetchJobApplication();\r\n    }\r\n  }, [userId, token]);\r\n\r\n  // تغيير صورة الملف الشخصي\r\n  const handleProfileImageChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n      setProfileImage(file);\r\n    }\r\n  };\r\n\r\n  // تغيير السيرة الذاتية\r\n  const handleResumeChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n      setResume(file);\r\n    }\r\n  };\r\n\r\n  // إزالة صورة الملف الشخصي\r\n  const handleRemoveProfileImage = async () => {\r\n    if (!formSubmitted && profileImage) {\r\n      try {\r\n        await axios.delete(\r\n          `/api/jobapplications/delete-profile-image/${userId}`,\r\n          {\r\n            params: { fileType: \"profileImage\" },\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          },\r\n        );\r\n        setProfileImage(null);\r\n      } catch (error) {\r\n        setError(\"حدث خطأ أثناء إزالة صورة الملف الشخصي.\");\r\n      }\r\n    }\r\n  };\r\n\r\n  // إزالة السيرة الذاتية\r\n  const handleRemoveResume = async () => {\r\n    if (!formSubmitted && resume) {\r\n      try {\r\n        await axios.delete(`/api/jobapplications/delete-resume/${userId}`, {\r\n          params: { fileType: \"resume\" },\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        setResume(null);\r\n      } catch (error) {\r\n        setError(\"حدث خطأ أثناء إزالة السيرة الذاتية.\");\r\n      }\r\n    }\r\n  };\r\n\r\n  // إرسال البيانات إلى السيرفر\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError(\"\");\r\n\r\n    if (!profileImage && !resume) {\r\n      setError(\"يرجى تحميل صورة الملف الشخصي والسيرة الذاتية.\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    const formData = new FormData();\r\n\r\n    if (profileImage instanceof File) {\r\n      formData.append(\"profileImage\", profileImage);\r\n    }\r\n\r\n    if (resume instanceof File) {\r\n      formData.append(\"file\", resume);\r\n    }\r\n\r\n    formData.append(\"userId\", userId);\r\n\r\n    try {\r\n      const response = await axios.post(\r\n        \"/api/jobapplications/create\",\r\n        formData,\r\n        {\r\n          headers: {\r\n            \"Content-Type\": \"multipart/form-data\",\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n        },\r\n      );\r\n\r\n      if (response.status === 200) {\r\n        alert(\"تم إضافة طلب الوظيفة بنجاح!\");\r\n        setFormSubmitted(true);\r\n      }\r\n    } catch (error) {\r\n      setError(\r\n        `حدث خطأ أثناء إضافة طلب الوظيفة: ${error.response?.data?.message || error.message}`,\r\n      );\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // المسار الأساسي من البيئة\r\n  const BASE_URL = process.env.REACT_APP_BASE_URL;\r\n\r\n  // عرض صورة الملف الشخصي\r\n  const renderProfileImage = (imagePath) => {\r\n    if (imagePath instanceof File) {\r\n      return (\r\n        <img\r\n          src={URL.createObjectURL(imagePath)}\r\n          alt=\"Profile\"\r\n          className=\"profile-image img-fluid\"\r\n        />\r\n      );\r\n    }\r\n\r\n    if (imagePath) {\r\n      const imageUrl = imagePath.startsWith(\"http\")\r\n        ? imagePath\r\n        : `${BASE_URL}${imagePath}`;\r\n      return (\r\n        <img src={imageUrl} alt=\"Profile\" className=\"profile-image img-fluid\" />\r\n      );\r\n    }\r\n\r\n    return <div className=\"profile-image-placeholder\">لا توجد صورة</div>;\r\n  };\r\n\r\n  // معاينة السيرة الذاتية\r\n  const renderResumePreview = () => {\r\n    const resumeUrl =\r\n      resume instanceof File\r\n        ? URL.createObjectURL(resume)\r\n        : `${BASE_URL}${resume}`;\r\n\r\n    if (resumeUrl.endsWith(\".pdf\")) {\r\n      return (\r\n        <div className=\"pdf-preview-container\">\r\n          <Worker workerUrl=\"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js\">\r\n            <Viewer fileUrl={resumeUrl} />\r\n          </Worker>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (resumeUrl.match(/\\.(jpeg|jpg|gif|png)$/)) {\r\n      return (\r\n        <img\r\n          src={resumeUrl}\r\n          alt=\"Resume Preview\"\r\n          className=\"resume-preview img-fluid\"\r\n        />\r\n      );\r\n    }\r\n\r\n    return <div>نوع الملف غير مدعوم</div>;\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mt-5 cdwork\">\r\n      <h2 className=\"my-4 text-center\">إضافة طلب وظيفة</h2>\r\n\r\n      {error && <div className=\"alert alert-danger\">{error}</div>}\r\n\r\n      <form onSubmit={handleSubmit}>\r\n        <div className=\"form-group text-center mb-4\">\r\n          <label htmlFor=\"profileImage\" className=\"form-label\">\r\n            صورة الملف الشخصي\r\n          </label>\r\n          <div className=\"profile-image-container\">\r\n            <input\r\n              type=\"file\"\r\n              className=\"form-control d-none\"\r\n              id=\"profileImage\"\r\n              onChange={handleProfileImageChange}\r\n              accept=\"image/*\"\r\n            />\r\n            {renderProfileImage(profileImage)}\r\n            <label htmlFor=\"profileImage\" className=\"change-button cb\">\r\n              {profileImage ? \"تغيير\" : \"إضافة\"}\r\n            </label>\r\n          </div>\r\n          {profileImage && !formSubmitted && (\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-danger mt-2\"\r\n              onClick={handleRemoveProfileImage}\r\n            >\r\n              إزالة صورة الملف الشخصي\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"form-group mb-4 text-center\">\r\n          <label htmlFor=\"resume\" className=\"form-label\">\r\n            السيرة الذاتية\r\n          </label>\r\n          <div className=\"resume-container\">\r\n            <input\r\n              type=\"file\"\r\n              id=\"resume\"\r\n              onChange={handleResumeChange}\r\n              accept=\".pdf,.doc,.docx,.rtf,image/*\"\r\n              className=\"d-none\"\r\n            />\r\n            {resume ? (\r\n              <>\r\n                <div className=\"resume-preview mt-3\">\r\n                  {renderResumePreview()}\r\n                </div>\r\n                {!formSubmitted && (\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn btn-danger mt-2\"\r\n                    onClick={handleRemoveResume}\r\n                  >\r\n                    إزالة السيرة الذاتية\r\n                  </button>\r\n                )}\r\n              </>\r\n            ) : (\r\n              <label htmlFor=\"resume\" className=\"change-button\">\r\n                إضافة السيرة الذاتية\r\n              </label>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"form-group text-center\">\r\n          <button type=\"submit\" className=\"btn btn-primary\" disabled={loading}>\r\n            {loading ? \"جاري الإضافة...\" : \"حفظ الطلب\"}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AddJobApplication;\r\n"],"names":["AddJobApplication","profileImage","setProfileImage","useState","resume","setResume","error","setError","loading","setLoading","userId","setUserId","formSubmitted","setFormSubmitted","token","localStorage","getItem","useEffect","decodedToken","JSON","parse","atob","split","async","response","axios","get","concat","headers","Authorization","status","data","jobApplication","profileImagePath","resumePath","err","fetchJobApplication","BASE_URL","process","_jsxs","className","children","_jsx","onSubmit","e","preventDefault","formData","FormData","File","append","post","alert","_error$response","_error$response$data","message","htmlFor","type","id","onChange","file","target","files","accept","imagePath","src","URL","createObjectURL","alt","imageUrl","startsWith","renderProfileImage","onClick","delete","params","fileType","_Fragment","renderResumePreview","resumeUrl","endsWith","Worker","workerUrl","Viewer","fileUrl","match","disabled"],"sourceRoot":""}